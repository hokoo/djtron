# djTRON
Браузерный плеер для дискотек и музыкальных мероприятий. Плеер имеет отдельные кнопки воспроизведения для каждого аудиофайла, индивидуальные уровни громкости и перекрытие дорожек (overlay).

<img width="512" height="auto" alt="image" src="https://github.com/user-attachments/assets/5a853fe1-f765-4d9b-b164-eeb639f7cc12" />

"Из коробки" прилагаются два трека 20 и 60 секунд, которые можно использовать как таймеры для интерактивов и музыкальных сетов.

Остальные треки не прилагаются, пользователь загружает их в приложение самостоятельно по своему усмотрению.

## Запуск

1. Убедитесь, что у вас установлен [Node.js](https://nodejs.org/en/download/current) (v18+).
2. Поместите аудиофайлы (mp3, wav, ogg, m4a, flac) в папку `audio/` в корне репозитория.
3. Запустите сервер:

```bash
npm start
```

По умолчанию сервер поднимется на `http://localhost:3000`.

## Авторизация удаленных клиентов

- Клиент на том же ПК, где запущен сервер, работает без логина.
- Клиенты с других ПК должны авторизоваться.
- После перезапуска сервера авторизация сохраняется на том же сервере до истечения сессии (12 часов по умолчанию).
- Учетки хранятся в папке `users/`:
  - один файл = один пользователь;
  - имя файла = логин (`dj.txt` или `dj`);
  - первая непустая строка в файле = пароль.

Пример:

```text
users/operator.txt
```

Содержимое файла:

```text
myStrongPassword123
```

## Работа по локальной сети (LAN)

1. Запустите сервер на основном ПК.
2. Узнайте IP основного ПК (`ipconfig` в Windows).
3. На втором ПК откройте `http://<IP_ОСНОВНОГО_ПК>:3000`.
4. В Windows Firewall разрешите входящие подключения на TCP-порт `3000`.

### Быстрый запуск на Windows

Чтобы не открывать терминал вручную и не вводить адрес в браузере, используйте файл `run-player.bat` в корне проекта. Двойной клик по файлу проверит наличие Node.js, запустит сервер (`npm start`) и автоматически откроет страницу `http://localhost:3000/` в браузере по умолчанию. Держите окно консоли открытым, пока пользуетесь приложением.

### Быстрый запуск на macOS

Используйте файл `run-player.command` в корне проекта. Двойной клик откроет терминал, проверит наличие Node.js и npm, запустит сервер (`npm start`) и откроет страницу `http://localhost:3000/` в браузере по умолчанию. Оставьте терминал открытым, пока сервер работает.

#### Если macOS не даёт запустить `run-player.command`

Иногда после скачивания (особенно через браузер) macOS помечает файл как загруженный из интернета и может блокировать запуск.

1) Сделать файл исполняемым (`+x`): 
```bash
chmod +x run-player.command
```

> NB! Убедитесь, что вы находитесь в каталоге с файлом `run-player.command`, либо укажите полный путь к файлу.

2) Снять системную метку блокировки (quarantine), если двойной клик всё равно не запускается:
```bash
xattr -d com.apple.quarantine run-player.command
```

## Функции

- Автоматический поиск файлов в каталоге `audio/` и вывод отдельной кнопки «Воспроизвести» для каждого трека.
- Организация треков по плей-листам (колонкам) без ограничения на количество плей-листов.
- Синхронизация плей-листов между всеми клиентами в реальном времени.
- Drag & drop: перенос треков между плей-листами; при зажатом `Ctrl` трек копируется (дублируется) в новое место.
- Переименование плей-листов с синхронизацией названий на всех подключенных клиентах.
- Удаление плей-листа с подтверждением: можно удалить пустой плей-лист или плей-лист, у которого все треки уже есть в других плей-листах.
- В верхней части интерфейса отображается единый прогресс текущего трека с кнопкой `start/pause`.
- При запуске нового трека предыдущий останавливается, либо плавно глушится через перекрытие, если задано время overlay.
- Все треки воспроизводятся с одинаковой громкостью.
- Настройки overlay:
  - **Overlay transition time** — длительность перекрытия дорожек (в секундах).
  - **Overlay volume transition function** — выбор кривой изменения громкости (linear, ease-in, ease-out, ease-in-out). Настройки сохраняются в `localStorage`.

## Примечания

- Приложение использует нативный `Audio` API в браузере, поэтому никаких внешних зависимостей ставить не нужно.
- В текущей конфигурации используются только треки из папки `audio/`.
- Чтобы обновить список аудио после добавления файлов, просто перезагрузите страницу.
